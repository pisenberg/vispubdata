<?xml version="1.0" encoding="UTF-8"?>
<TEI xml:space="preserve" xmlns="http://www.tei-c.org/ns/1.0" 
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
xsi:schemaLocation="http://www.tei-c.org/ns/1.0 /home/pisenberg/grobid/grobid-0.6.1/grobid-home/schemas/xsd/Grobid.xsd"
 xmlns:xlink="http://www.w3.org/1999/xlink">
	<teiHeader xml:lang="en">
		<fileDesc>
			<titleStmt>
				<title level="a" type="main">Flow Map Layout</title>
			</titleStmt>
			<publicationStmt>
				<publisher/>
				<availability status="unknown"><licence/></availability>
			</publicationStmt>
			<sourceDesc>
				<biblStruct>
					<analytic>
						<author>
							<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Doantam</forename><surname>Phan</surname></persName>
							<affiliation key="aff0">
								<orgName type="institution">Stanford University</orgName>
							</affiliation>
						</author>
						<author>
							<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Ling</forename><surname>Xiao</surname></persName>
							<affiliation key="aff0">
								<orgName type="institution">Stanford University</orgName>
							</affiliation>
						</author>
						<author>
							<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Ron</forename><surname>Yeh</surname></persName>
							<affiliation key="aff0">
								<orgName type="institution">Stanford University</orgName>
							</affiliation>
						</author>
						<author>
							<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Pat</forename><surname>Hanrahan</surname></persName>
							<affiliation key="aff0">
								<orgName type="institution">Stanford University</orgName>
							</affiliation>
						</author>
						<author>
							<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Terry</forename><surname>Winograd</surname></persName>
							<affiliation key="aff0">
								<orgName type="institution">Stanford University</orgName>
							</affiliation>
						</author>
						<title level="a" type="main">Flow Map Layout</title>
					</analytic>
					<monogr>
						<imprint>
							<date/>
						</imprint>
					</monogr>
				</biblStruct>
			</sourceDesc>
		</fileDesc>
		<encodingDesc>
			<appInfo>
				<application version="0.6.1" ident="GROBID" when="2021-02-19T18:51+0000">
					<desc>GROBID - A machine learning software for extracting information from scholarly documents</desc>
					<ref target="https://github.com/kermitt2/grobid"/>
				</application>
			</appInfo>
		</encodingDesc>
		<profileDesc>
			<textClass>
				<keywords>
					<term>I.3.3 [Computer Graphics]: Picture/Image Generation -Viewing Algorithms flow maps</term>
					<term>GIS</term>
					<term>hierarchical clustering</term>
				</keywords>
			</textClass>
			<abstract>
				<p>Cartographers have long used flow maps to show the movement of objects from one location to another, such as the number of people in a migration, the amount of goods being traded, or the number of packets in a network. The advantage of flow maps is that they reduce visual clutter by merging edges. Most flow maps are drawn by hand and there are few computer algorithms available. We present a method for generating flow maps using hierarchical clustering given a set of nodes, positions, and flow data between the nodes. Our techniques are inspired by graph layout algorithms that minimize edge crossings and distort node positions while maintaining their relative position to one another. We demonstrate our technique by producing flow maps for network traffic, census data, and trade data.</p>
			</abstract>
		</profileDesc>
	</teiHeader>
	<text xml:lang="en">
		<body>
<div xmlns="http://www.tei-c.org/ns/1.0"><head>INTRODUCTION</head><p>Visualizing network flow and topology is challenging because displaying a large number of connections with lines results in visual clutter. SeeNet <ref type="bibr" target="#b3">[3]</ref> let users adjust the visualization parameters of the map to manually reduce clutter and provided alternative designs to link maps. Node maps eliminated links and displayed connection data as node size. Matrix displays removed the geographic layout and encoded data by color. Other work tried to minimize clutter by using an extra dimension. SeeNet 3D <ref type="bibr">[4;5]</ref> and work by Munzner <ref type="bibr" target="#b14">[14]</ref> on Mbone visualization, drew links as variable-height arcs over a 2D map, where the height was encoded as the traffic volume. Unfortunately, these techniques still produce cluttered maps when encoding geographic detail, connectivity, and traffic volume on one map.</p><p>Cartographers have solved this problem with flow maps, which illustrate the movement of objects among locations. A flow map shows the spatial distribution of univariate geographic phenomena <ref type="bibr" target="#b17">[17]</ref>. Lines of varying width which represent the number of objects being transferred are overlaid on the map. Visual clutter is reduced by merging edges that share destinations. The first flow maps illustrated rail ridership in Ireland and since then, cartographers have used flow maps to depict migrations, trade, and any data set with a from-to relationship <ref type="bibr" target="#b6">[6]</ref>.</p><p>Our goal is to produce flow maps to visualize networks and other kinds of flow data. A well-drawn flow map allows a user to see the differences in magnitude among the flows with a minimum of clutter. <ref type="figure" target="#fig_0">Figure 1a</ref> is a hand drawn map by Minard illustrating the export of wine from France. <ref type="figure" target="#fig_0">Figure 1b</ref> shows a computer generated flow map by Tobler <ref type="bibr">[18; 19]</ref>, which is still cluttered because it does not take advantage of the techniques of hand-drawn maps.</p><p>Our contribution is a technique that automatically generates flow maps. <ref type="figure" target="#fig_0">Figure 1c</ref> illustrates a flow map generated automatically by our system. Our approach uses hierarchical clustering to create a flow tree that connects a source (the root) to a set of destinations (the leaves). Our algorithm attempts to minimize edge crossings and supports the layering of singlesource flow maps to create multiple-source flow maps. We do this by preserving branching substructure across flow maps with different roots that share a common set of nodes. We have produced flow maps for trade data, network traffic, and migration data. 1</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2">SYSTEM DESIGN</head><p>Our analysis of good, hand-drawn flow maps reveals three common characteristics: intelligent distortion of positions, merging of edges that share destinations, and intelligent edge routing. Our technique attempts to produce flow maps with the same characteristics as these hand-drawn exemplars. Minard's map of wine exports ( <ref type="figure" target="#fig_0">Figure 1a</ref>) illustrates these characteristics. The Strait of Gibraltar has been widened and the UK has been 1 dphan, lingxiao, ronyeh @ graphics.stanford.edu 2 hanrahan, winograd @ cs.stanford.edu  shifted away from France to make room for the flow lines. However, these distortions preserve the relative positions of countries with respect to one another. Edges going to different regions of the world are merged and in this map, edge crossings are minimized.</p><p>Other characteristics of flow maps described by cartographers concern their visual appearance <ref type="bibr" target="#b6">[6]</ref>. Flow lines should be the dominant visual element and should be easily distinguishable from other map symbols. A linear mapping should be used to transform data values to line thickness. The map legend must be clear and provide key values for line widths. If edges cross, smaller lines should rest on top of larger lines. To our knowledge, there are no published guidelines describing how to layout a handdrawn flow map, which is the focus of this paper.</p><p>We achieve intelligent distortion of positions by using a layout adjustment algorithm that ensures that the separation distance between nodes is greater than the maximum thickness of the flow lines. This algorithm guarantees that nodes maintain their leftright and up-down positions relative to one another <ref type="bibr" target="#b12">[12]</ref>.</p><p>Merging edges that share destinations is done by using hierarchical clustering to find nodes that are close together. The tree formed by the hierarchical clustering is the basis for the branching structure of the flow map. The clustering is generated such that the root of the flow map is the root of the tree. We use a binary hierarchical clustering because it allows us to formulate the layout in a simple and recursive manner.</p><p>Our edge drawing and routing also uses hierarchical clustering. The recursive procedure to layout node positions uses the fact that all branches are binary. Clusters are modeled as rectangular bounding boxes enclosing their nodes. The edges check for intersections with the bounding boxes of their siblings. If an intersection exists, we place the node such that edges connected to that node are routed around the bounding box.</p><p>To visualize more general networks using flow maps, we want to support maps with more than one root. We can create multiplesource maps by layering single-source maps that have been generated by our algorithm. To make layering more effective, we preserve node position and branching structure across flow maps, which makes it easier to compare and contrast flow patterns across different layers. This is done by generating a primary hierarchical clustering that relies on the positions of the input set of nodes. The rooted clustering tree used to lay out each flow map is a modification of the primary hierarchical clustering tree. <ref type="figure" target="#fig_1">Figure 2</ref> presents an overview of our system. The input to our system consists of a set of nodes, positions, and flow data among the nodes. There are layout phases and a rendering phase.</p><p>Layout phases ensure nodes are adequately spaced, generate a topological layout tree, choose the positions of the branching points, and route edges around obstacles. The rendering phase converts the given spatial layout tree into a set of thick splines for each edge and generates a legend for the flow map.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3">LAYOUT</head><p>Sections 3.1 to 3.5 describe the steps of the algorithm for generating a single-source flow map. In 3.6 we describe the additional considerations that arise from having multiple layers in the system.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head>3.1</head><p>Layout Adjustment The layout adjustment step enforces a minimum separation distance among the nodes in the horizontal and vertical directions and preserves their relative positions to one another. We specify the minimum separation distance to be the maximum width of a flow line in pixels. We use Misue et al.'s force scan algorithm <ref type="bibr" target="#b12">[12]</ref> which runs in O(n 2 ). We have observed that good flow maps contain a moderate number of nodes (less than 100), so the efficiency of the algorithm is not an issue. Nodes are sorted into two lists, one ordered by x-coordinate and the other ordered by ycoordinate. The algorithm consists of a horizontal scan followed by a vertical scan.</p><p>We also experimented with a force directed scheme from the graph drawing literature <ref type="bibr" target="#b2">[2]</ref>. The problem we encountered was that force directed methods often included randomness in the system to avoid local minima in layout. However, we were interested in generating flow maps with stable node positions for a given set of nodes. The force directed technique resulted in slightly different layouts each time, so we chose to use the algorithm of Misue et al. <ref type="bibr" target="#b12">[12]</ref> which remains stable. Note that keeping node positions stable allows us to layer flow maps on top of one another. However, without this constraint, there might have been a better way to create a flow map by adjusting positions.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3.2">Primary Hierarchical Clustering</head><p>The primary hierarchical clustering captures information about the spatial distribution of the input nodes. We use an agglomerative hierarchical clustering <ref type="bibr" target="#b9">[9]</ref> that creates a binary tree from the input set of nodes. The input nodes are at the leaves of the primary hierarchical clustering. The distance between two clusters is the Euclidean distance between the centers of their rectangular bounding boxes. <ref type="figure" target="#fig_2">Figure 3</ref> gives an example of how a primary clustering is generated.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head>3.3</head><p>Rooted Hierarchical Clustering We want to generate a flow map with a given node r at the root. The tree produced by the primary hierarchical clustering is not suitable because its root is a combination of clusters of input nodes. To generate a tree where node r is the root and connects to the other input nodes, we modify the tree produced by the primary clustering. For a given root node r, we accumulate nodes to be reclustered by following parent pointers from node r to the root of the primary clustering tree. We add clusters hanging off this path to our set to be reclustered, including the cluster with node r. <ref type="figure" target="#fig_2">Figure 3</ref> demonstrates how rooted clustering modifies a primary clustering.</p><p>Our theoretical analysis indicates that following these parent pointers takes O(lg m) time, and clustering the accumulated set takes O(lg m) <ref type="bibr" target="#b2">2</ref> time, where m is the total number of nodes in the system, including nodes generated by the primary clustering as well as the input nodes. We note that this is O(n) nodes, where n is the number of input nodes in the system. Without re-use of substructure from the primary clustering, our rooted clustering would take O(m 2 ). Currently the system implements the simplified version of our algorithm that takes O(m 2 ).</p><p>Rooted hierarchical clustering merges nodes differently from standard hierarchical clustering. Suppose the algorithm wants to merge clusters C1 and C2 because they are the closest in the system. Before it does so, it checks to see if C1 or C2 contains the root node r. Suppose C1 contains r. C2 is marked for attempting to merge with the root. The algorithm looks for another cluster C3 to merge with C2. C3 must be unmarked and distance(C2,C3) â‰¤ distance(C2, root). If we only marked the C2 cluster without looking for C3, we might miss an opportunity to merge clusters on the same side of the root. The distance check ensures that we do not merge nodes on opposite sides of the root. The algorithm terminates if it cannot find an unmarked cluster C3.</p><p>When the reclustering terminates due to the algorithm being unable to find any unmarked clusters, the remaining clusters in the system become the children of the source cluster. Note that all the nodes except for the root of a rooted clustering have two children. Since reclustering may terminate with more than two marked clusters, a rooted hierarchical clustering is not always a binary tree, in contrast to a primary clustering, which is always binary.</p><p>The last step in the rooted clustering computes the weights of the clusters. Given the flow data among the nodes, we know how much data flows from the root r to our destination nodes. This is recorded as the weight of a node. We compute the weight for each cluster, bottom-up, in O(m) time.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head>3.4</head><p>Spatial Layout The next step is to recursively lay out the tree of flows rooted at the source. Each node creates a branching structure from the parent to its two children. The challenge is to minimize edge crossings. We assume that the bounding boxes of the children do not overlap. If the layout of the subtrees corresponding to each child is contained within its bounding box, then the branch between the parent and the child will not intersect the tree corresponding to the child.</p><p>We create a branching node between the root and each of its immediate child clusters. We choose the position of that node by drawing a line l from the root's position a, to the center of the cluster c. The closest intersection of l with c's bounding box is called b. The position of the branching node is the average position of a and b, or (a+b)/2. We recurse on the grand children of the root nodes. <ref type="figure" target="#fig_3">Figure 4</ref> illustrates the placement of a binary branching point for the three cases: a split between two leaf nodes, one leaf node   Outgoing migration map from Colorado from 1995-2000, generated by our algorithm without layout adjustment or edge routing. Note how the spatial structure imposed by our hierarchical clustering still merges edges in a way that produces a clean map despite the lack of edge routing. and a cluster, or two clusters. Branching nodes n are placed halfway between the position of the start node, a, and another point b. For two leaf clusters, b is the location of the heavier node. For the other cases, let l be a line between a and the center of the heavier cluster. b is the closest point to a, on the line l, that intersects the bounding box of either child cluster. In both cases the position of the branching node n is set to be (a+b)/2.</p><p>We always add an edge from our starting node to the branching node n, and an edge from n to the leaf nodes. We always recurse on clusters. Note the branching point may be placed where an outgoing edge intersects the bounding box of one of its children. We describe how we avoid these intersections in the next section.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3.5">Edge Routing</head><p>We route edges around the bounding boxes within the same hierarchical cluster. A consequence of this is that the edges from the root node to its immediate children are not routed, because they are not in a cluster with one another. We will discuss this issue in more detail in Section 5. We illustrate how we route edges around sibling clusters for the case of two clusters in <ref type="figure" target="#fig_4">Figure  5</ref>.</p><p>Step 1 illustrates how for each branching point b1, we check if the edge b1-b2 or the edge b1-b3 intersects its sibling's bounding box. We see that b1-b3 intersects the bounding box of cluster c1, so we know that c1 occludes c2.</p><p>Step 2 shows how we find the closest corner on the bounding box c1 to the line b1-b3 and create a new node at that corner to route the edge around the bounding box. In Step 3, we check the line from the new node to b3 and see if it intersects c1. If it does, we move the point b3 to just outside the corner of the bounding box of c1. <ref type="figure" target="#fig_4">Figure 5</ref> also illustrates how we decide which corner to position nodes. If an edge that intersects a bounding box, it splits it into two parts. We compute the areas of each part of the box that was split by the edge. We choose the corner on the side of the edge with less area.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head>3.6</head><p>Multiple-Layer Issues Previous sections described how the layout works for a single layer, which is created to depict data from an initial query. Here we describe the modifications to the algorithm when users generate further queries to get a combined visualization.</p><p>Each additional query might introduce new nodes that did not exist in the previous query. As a result, the layout adjustment step must be re-run for each new query, which may take O(m 2 ) where m is the total number of unique nodes accumulated over all the queries. We reset the positions of all the nodes to their initial locations, and then run the layout adjustment step as described in 3.1. When we get new nodes, we also run the primary hierarchical clustering step again, which also takes O(m 2 ).</p><p>The hierarchical clustering steps in our system must be modified to account for the fact that not every cluster belongs to every layer. Every cluster has a list of the layers with which it is associated. Clusters also store a mapping from layers to a list of their subclusters which appear in that layer. Our current implementation of rooted clustering runs in O(m 2 ). This is because we do not propagate the layer information up the tree when constructing the primary hierarchical clustering, so we have to inspect the subtree to find which subclusters appear in which layer. However, by storing subclusters' information at each level, this would improve the running time of rooted clustering O(lg m) to accumulate nodes and O(lg m) <ref type="bibr" target="#b2">2</ref> to recluster the set.</p><p>We note that the edge routing is done on a per-layer basis, which will cause many edge crossings if too many maps are layered on top of one another.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="4">RENDERING</head><p>To make the flow map visually appealing, each edge is rendered as a catmull-rom spline which interpolates between the nodes of the spatial layout tree that we produced. The splines are rendered such that they have width proportional to the weight of the edge. We can set the widths of the splines to lie between a minimum and a maximum display width. We map the data to this interval using a linear or a logarithmic function. We adjust the splines so that edge widths add up visually. For each binary branch, we shift the starting point of the child splines by a distance proportional to the width of the child, in a direction perpendicular to the vector that represents the edge.</p><p>We generate a legend for the map by running k-means clustering <ref type="bibr" target="#b9">[9]</ref> on all the edge widths that appear in the map. We chose to generate 7 categories for the legend. Since we do not enforce that a bin in our k-means should not contain 0, some legends generated by our system may have less than 7 categories. The location of the legend on the map is set manually. A unique color is set for each layer so to distinguish them better.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="5">RESULTS AND DISCUSSION</head><p>We used several data sets to test our method. The US Census data for 1995-2000 <ref type="bibr" target="#b21">[21]</ref> records all of the county to county migrations. Network traffic data was recorded from our lab's router over a period of several months. The ecological footprint data is courtesy of the Footprint Network <ref type="bibr" target="#b13">[13]</ref>. All the node positions were specified in latitude and longitude, and converted to screen space via a Mercator projection. The maps produced by <ref type="figure">Figure 7</ref>. Outgoing migration map from Colorado for 1995-2000 generated using edge routing but no layout adjustment.</p><p>our system were produced in a few seconds of time on a 1.4GHz laptop. The system itself is written in Java using the prefuse visualization toolkit developed by Heer <ref type="bibr" target="#b8">[8]</ref>.</p><p>Our technique produces aesthetically pleasing flow maps for a variety of data sets. However, there are still cases where the flow maps do not look as good as expected. To understand these failure cases, we analyze our technique in terms of the three characteristics of the good flow maps.</p><p>Intelligent Distortion. The force scan algorithm <ref type="bibr" target="#b12">[12]</ref> used for layout adjustment separates the nodes and guarantees that we are not changing the relative positions of the nodes to one another. The problem with this method can be seen by comparing <ref type="figure" target="#fig_0">Figure  1c</ref> with <ref type="figure" target="#fig_5">Figure 6</ref>. While <ref type="figure" target="#fig_5">Figure 6</ref> is clearly recognizable as the outline of the United States, <ref type="figure" target="#fig_0">Figure 1c</ref> has been vertically distorted so that the states on the East Coast are spread apart. This stretches out the West Coast too much.</p><p>Merging of edges that share destinations. Our simple version of hierarchical clustering is able to find spatial clusters in the data sets we use. The biggest drawback to our algorithm in this regard is that all splits are binary. If there are too many destination nodes in a small area, forcing binary splits introduces too many extra routing nodes and leads to clutter. In addition, with too many nodes, continuity constraints for splines cause them to loop.</p><p>Intelligent edge routing. Our heuristic works well for simpler cases ( <ref type="figure">Figure 7</ref>) and sometimes does not work well for larger cases <ref type="figure" target="#fig_6">(Figure 8</ref>). One problem is that we do not perform any routing on the edges leaving the root. Branches in these separate binary trees don't know about each other and may overlap. In <ref type="figure" target="#fig_6">Figure 8</ref>, the reason why there are so many edge crossings is that our method assumes bounding boxes created by our spatial clustering are disjoint. However, our clustering does not always produce disjoint boxes, so we cannot always apply our heuristic.</p><p>Layering and branching structure. We have found that the method for sharing substructure across flow maps that share a common set of nodes works quite well. <ref type="figure" target="#fig_7">Figure 9</ref> has an example where two flow maps layered together share branching structure to several nodes.</p><p>Linear or logarithmic display widths. In our initial maps we used logarithms to map our data to a display width, because we were working with network data where there were many orders of magnitude in the data that we were plotting. However, for data sets not dominated by a few high magnitude values, we find that linear mappings draw the eye more. All the maps we demonstrated in this paper use linear mappings.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="6">RELATED WORK</head><p>A survey of American flow mapping history and techniques is described in <ref type="bibr" target="#b15">[15]</ref>. Flow map design is discussed in various geography textbooks <ref type="bibr">[6; 17]</ref>. Guidelines are given on legend design and the use of a visual hierarchy to emphasize flow lines over region boundaries. Ruggles and Armstrong <ref type="bibr" target="#b16">[16]</ref> discuss a framework for the cartographic visualization of networks. More generally, map design is discussed in <ref type="bibr" target="#b11">[11]</ref>.</p><p>An alternative method of layout adjustment is described by Lyons <ref type="bibr" target="#b10">[10]</ref>, who improves the distribution of nodes in a graph and uses measures for graph similarity and distribution to decide if too much distortion has occurred. Since this method tends to more evenly distribute the nodes, it tends to blur out geographic features, which is not as useful for flow maps.</p><p>Our edge routing technique is related to the ones found in the graph drawing literature. Dobkin et al. <ref type="bibr" target="#b7">[7]</ref> describes how to route individual edges through a set of obstacles represented by polygons. Unfortunately, they leave the question how to do this for multiple edges open.</p><p>Our work is related to Agrawala and Stolte [1], who studied hand-drawn route maps to understand the principles that made them effective. They made use of intelligent distortion to produce computer generated route maps.  </p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="7">CONCLUSION AND FUTURE WORK</head><p>There are many areas of future work suggested by this project. Global enforcement of horizontal and vertical ordering seems too strict for flow maps. A better layout adjustment algorithm might only enforce horizontal and vertical ordering within some 2D local window of each node, so that things may be globally distorted but locally consistent.</p><p>Although using binary clustering makes our spatial layout step simpler, having non-binary splits could eliminate some clutter and some loopy edges. Also, instead of our heuristic-based method for edge routing, it may be possible to use simulated annealing to adjust the edge positions.</p><p>We are also interested in the layout and display of data that does not explicitly have a location. Although all of our work has been on data sets with geographic locations, it may be interesting to generate flow maps for more abstract sets of objects that have no predefined positions but that can be grouped in other ways. Now that we have an algorithm to generate flow maps programmatically, we are interested in developing techniques to interact with the data. We are interested in working with people who analyze flow data to see how they use an interactive tool.</p><p>In this paper, we have presented a method to automatically generate flow maps. We use distortion to ensure that our nodes are well spaced but still preserve their relative positions to one another. We merge edges based on their destinations using hierarchical clustering. This allows flow maps with the same input nodes to share branching structures. Finally we use the spatial information given to us by the hierarchical clustering to do edge routing to avoid edge crossings. <ref type="figure" target="#fig_0">Figure 11</ref>. An example of the top ASN (Autonomous Systems) that a computer from our lab communicated with in one day. The latitudes and longitudes for the ASNs were obtained by manually looking for the city or state in which the ASN was registered. <ref type="figure" target="#fig_0">Figure 10</ref>. California and New York migration. Another example of how layering can be used in our system. The map shows the top 10 states that migrate to California and New York. Flow maps make it easy to spot an interesting spatial pattern, namely that New York tends to attract people from the East Coast, while California residents come from more geographic regions in the United States.</p></div><figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_0"><head>Figure 1 .</head><label>1</label><figDesc>Flow Maps. (a) Minard's 1864 flow map of wine exports from France [20] (b) Tobler's computer generated flow map of migration from California from 1995 -2000. [18; 19] (c) A flow map produced by our system that shows the same migration data.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_1"><head>Figure 2 .</head><label>2</label><figDesc>System Diagram</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_2"><head>Figure 3 .</head><label>3</label><figDesc>Hierarchical Clustering. A flow map tree is generated by clustering a set of nodes. (a) We show a spatial representation of the primary hierarchical clustering (PHC) and its equivalent tree. Rooted hierarchical clustering (RHC) modifies the PHC to produce a flow map for a particular root. The x's on the bounding boxes indicate the clusters that are not reused. (b) The RHC for a flow map from C. The (A,B) and the ((D,E),F) clusters are kept. (c) The RHC for a flow map from D. Only the (A,B) cluster is preserved.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_3"><head>Figure 4 .</head><label>4</label><figDesc>Spatial Layout. The binary structure of the rooted clustering allows to us generate the layout recursively. Branching points are always placed on the line between the start node and the destination that has more weight (or flow).</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_4"><head>Figure 5 .</head><label>5</label><figDesc>Edge Routing. Spatial layout may cause an intersection by placing b3 in a way that intersects c1. The algorithm finds the intersection of b1-b3 with c1, and adds a new node and adjusts the position of b3 to avoid c1 if necessary.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_5"><head>Figure 6 .</head><label>6</label><figDesc>Figure 6. Outgoing migration map from Colorado from 1995-2000, generated by our algorithm without layout adjustment or edge routing. Note how the spatial structure imposed by our hierarchical clustering still merges edges in a way that produces a clean map despite the lack of edge routing.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_6"><head>Figure 8 .</head><label>8</label><figDesc>Imports to China. A part of a flow map showing the top 200 countries from which China (bottom right) receives imports. The thick line curving around the top are the imports from the USA (not shown), which without edge routing would have gone straight through the middle of the image. Edge crossings still occur in some parts of the map, illustrating cases where our routing does not work. For more information see the discussion in Section 5.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_7"><head>Figure 9 .</head><label>9</label><figDesc>Branching Structure. A close-up of top 15 imports to Spain and France. Notice the branching structure is shared across different nodes, for example Spain, and France branch to the Netherlands, Germany and the UK in the same way.</figDesc></figure>
		</body>
		<back>

			<div type="acknowledgement">
<div xmlns="http://www.tei-c.org/ns/1.0"><head>ACKNOWLEDGEMENTS</head><p>This work was supported by the Stanford Regional Visual Analytics Center and the Department of Energy.</p></div>
			</div>

			<div type="references">

				<listBibl>

<biblStruct xml:id="b0">
	<monogr>
		<title level="m">IEEE Symposium on Information Visualization</title>
		<imprint>
			<date type="published" when="2005" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b1">
	<monogr>
		<title level="m" type="main">Rendering Effective Route Maps: Improving Usability Through Generalization</title>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Maneesh</forename><surname>Agrawala</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Chris</forename><surname>Stolte</surname></persName>
		</author>
		<imprint>
			<date type="published" when="2001" />
			<biblScope unit="page" from="241" to="250" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b2">
	<monogr>
		<title level="m" type="main">Graph Drawing</title>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Giuseppe</forename><forename type="middle">Di</forename><surname>Battista</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Peter</forename><surname>Eades</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Roberto</forename><surname>Tamassia</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Ioannis</forename><forename type="middle">G</forename><surname>Tolis</surname></persName>
		</author>
		<imprint>
			<date type="published" when="1999" />
			<publisher>Prentice Hall</publisher>
			<pubPlace>New Jersey</pubPlace>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b3">
	<monogr>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Richard</forename><forename type="middle">A</forename><surname>Becker</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Stephen</forename><forename type="middle">G</forename><surname>Eick</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Allan</forename><forename type="middle">R</forename><surname>Wilks</surname></persName>
		</author>
		<title level="m">Visualizing Network Data. IEEE Transactions on Visualization and Computer Graphics</title>
		<imprint>
			<date type="published" when="1995" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b4">
	<analytic>
		<title level="a" type="main">Case Study: 3D Displays of Internet Traffic</title>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">C</forename><surname>Kenneth</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Stephen</forename><forename type="middle">G</forename><surname>Cox</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><surname>Eick</surname></persName>
		</author>
	</analytic>
	<monogr>
		<title level="m">Proceedings of Infovis</title>
		<meeting>Infovis</meeting>
		<imprint>
			<date type="published" when="1995" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b5">
	<monogr>
		<title level="m" type="main">3D geographic network displays. SIGMOD Rec</title>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">C</forename><surname>Kenneth</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Stephen</forename><forename type="middle">G</forename><surname>Cox</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Taosong</forename><surname>Eick</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><surname>He</surname></persName>
		</author>
		<imprint>
			<date type="published" when="1996" />
			<publisher>ACM Press</publisher>
			<biblScope unit="volume">25</biblScope>
			<biblScope unit="page" from="50" to="54" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b6">
	<monogr>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">D</forename><surname>Borden</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><surname>Dent</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><surname>Cartography</surname></persName>
		</author>
		<title level="m">Thematic map design</title>
		<meeting><address><addrLine>New York</addrLine></address></meeting>
		<imprint>
			<publisher>McGraw-Hill</publisher>
			<date type="published" when="1999" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b7">
	<monogr>
		<title level="m" type="main">Implementing a General-Purpose Edge Router</title>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">David</forename><forename type="middle">P</forename><surname>Dobkin</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Emden</forename><forename type="middle">R</forename><surname>Gansner</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Eleftherios</forename><surname>Koutsofios</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Stephen C</forename><surname>North</surname></persName>
		</author>
		<imprint>
			<date type="published" when="1997" />
			<publisher>Springer-Verlag</publisher>
			<biblScope unit="page" from="262" to="271" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b8">
	<monogr>
		<title level="m" type="main">prefuse: a toolkit for interactive information visualization</title>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Jeffrey</forename><surname>Heer</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Stuart</forename><forename type="middle">K</forename><surname>Card</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">James</forename><forename type="middle">A</forename><surname>Landay</surname></persName>
		</author>
		<imprint>
			<date type="published" when="2005" />
			<biblScope unit="page" from="421" to="430" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b9">
	<analytic>
		<title level="a" type="main">Data clustering: a</title>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">A</forename><forename type="middle">K</forename><surname>Jain</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">M</forename><forename type="middle">N</forename><surname>Murty</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">P</forename><forename type="middle">J</forename><surname>Flynn</surname></persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">review ACM Comput. Surv</title>
		<imprint>
			<biblScope unit="volume">31</biblScope>
			<biblScope unit="page" from="264" to="323" />
			<date type="published" when="1999" />
			<publisher>ACM Press</publisher>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b10">
	<monogr>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Kelly</forename><forename type="middle">A</forename><surname>Lyons</surname></persName>
		</author>
		<title level="m">Cluster busting in anchored graph drawing IBM Press</title>
		<imprint>
			<date type="published" when="1992" />
			<biblScope unit="page" from="7" to="17" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b11">
	<monogr>
		<title level="m" type="main">How maps work: Representation, Visualization, and Design</title>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Alan</forename><surname>Maceachren</surname></persName>
		</author>
		<imprint>
			<date type="published" when="1995" />
			<publisher>Guilford Press</publisher>
			<pubPlace>New York</pubPlace>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b12">
	<analytic>
		<title level="a" type="main">Layout adjustment and the Mental Map</title>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Kazuo</forename><surname>Misue</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Peter</forename><surname>Eades</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Wei</forename><surname>Lai</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Kozo</forename><surname>Sugiyama</surname></persName>
		</author>
	</analytic>
	<monogr>
		<title level="m">Journal of Visual Languages and Computing</title>
		<imprint>
			<date type="published" when="1995" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b13">
	<monogr>
		<title level="m" type="main">International Ecological Trade Flows. Global Footprint Network. www.footprintnetwork.org</title>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">D</forename><surname>Moran</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">M</forename><surname>Wackernagel</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">S</forename><surname>Goldfinger</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">M</forename><surname>Murray</surname></persName>
		</author>
		<imprint>
			<date type="published" when="2005" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b14">
	<monogr>
		<title level="m" type="main">Visualizing the global topology of the MBone</title>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">T</forename><surname>Munzner</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">E</forename><surname>Hoffman</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">K</forename><surname>Claffy</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">B</forename><surname>Fenner</surname></persName>
		</author>
		<imprint>
			<date type="published" when="1996" />
		</imprint>
	</monogr>
	<note>InfoVis</note>
</biblStruct>

<biblStruct xml:id="b15">
	<monogr>
		<title level="m" type="main">Unpublished master&apos;s thesis</title>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">M</forename></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Jody</forename><surname>Parks</surname></persName>
		</author>
		<imprint/>
		<respStmt>
			<orgName>Atlanta: Georgia State University, Department of Geography</orgName>
		</respStmt>
	</monogr>
	<note>American Flow Mapping</note>
</biblStruct>

<biblStruct xml:id="b16">
	<analytic>
		<title level="a" type="main">Toward a conceptual framework for the cartographic visualization of network information</title>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Amy</forename><forename type="middle">J</forename><surname>Ruggles</surname></persName>
		</author>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Marc</forename><forename type="middle">P</forename><surname>Armstrong</surname></persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Cartographica</title>
		<imprint>
			<biblScope unit="volume">34</biblScope>
			<biblScope unit="page" from="1" to="15" />
			<date type="published" when="1997" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b17">
	<monogr>
		<title level="m" type="main">Thematic cartography and visualization</title>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Terry</forename><forename type="middle">A</forename><surname>Slocum</surname></persName>
		</author>
		<imprint>
			<date type="published" when="1999" />
			<publisher>Prentice Hall</publisher>
			<pubPlace>New Jersey</pubPlace>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b18">
	<monogr>
		<title level="m" type="main">Experiments in Migration Mapping by Computer. American Cartographer</title>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Waldo</forename><surname>Tobler</surname></persName>
		</author>
		<imprint>
			<date type="published" when="1987" />
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b19">
	<monogr>
		<title level="m" type="main">Movement Mapping</title>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Waldo</forename><surname>Tobler</surname></persName>
		</author>
		<ptr target="http://csiss.ncgia.ucsb.edu/clearinghouse/FlowMapper.2004" />
		<imprint/>
	</monogr>
</biblStruct>

<biblStruct xml:id="b20">
	<monogr>
		<title level="m" type="main">The Visual Display of Quantitative Information</title>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">Edward</forename><forename type="middle">R</forename><surname>Tufte</surname></persName>
		</author>
		<imprint>
			<date type="published" when="2001" />
			<publisher>Graphics Press</publisher>
			<pubPlace>Chesire, Conneticut</pubPlace>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b21">
	<monogr>
		<author>
			<persName xmlns="http://www.tei-c.org/ns/1.0"><forename type="first">U</forename><forename type="middle">S</forename><surname>Bureau</surname></persName>
		</author>
		<ptr target="http://www.census.gov/population/www/cen2000/ctytoctyflow.html" />
		<title level="m">County-to-County Migration Flow Files</title>
		<imprint>
			<date type="published" when="2003" />
		</imprint>
	</monogr>
</biblStruct>

				</listBibl>
			</div>
		</back>
	</text>
</TEI>
